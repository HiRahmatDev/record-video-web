(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function o(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(n){if(n.ep)return;n.ep=!0;const i=o(n);fetch(n.href,i)}})();const p={DEFAULT_RECORDING_FORMAT:"video/mp4",DEFAULT_RECORD_TIME_SLICE:1e4,INDEXED_DB:{DB_NAME:"recordingDB",STORES:{VIDEO_CHUNKS:"videoChunks"}}},m=p.INDEXED_DB.DB_NAME,d=p.INDEXED_DB.STORES;let a;async function w(){return new Promise((e,t)=>{const o=indexedDB.open(m,1);o.onerror=()=>{var r;console.error(`open idb error: ${(r=o.error)==null?void 0:r.message}`),t()},o.onsuccess=()=>{console.log("open idb success",o.result),a=o.result,e(a)},o.onupgradeneeded=r=>{var n;a=(n=r.target)==null?void 0:n.result,console.log("db upgraded",a),a.objectStoreNames.contains(d.VIDEO_CHUNKS)||a.createObjectStore(d.VIDEO_CHUNKS,{keyPath:"timestamp"})}})}function I(){return new Promise((e,t)=>{const n=a.transaction(d.VIDEO_CHUNKS,"readwrite").objectStore(d.VIDEO_CHUNKS).clear();n.onerror=()=>{t(n.error)},n.onsuccess=()=>{e(n.result)}})}async function C(e){return new Promise((t,o)=>{const i=a.transaction(d.VIDEO_CHUNKS,"readwrite").objectStore(d.VIDEO_CHUNKS).add({chunk:e,timestamp:Date.now()});i.onerror=()=>{o(i.error)},i.onsuccess=()=>{console.log("success save chunk:",i.result),t(i.result)}})}async function v(){return new Promise((e,t)=>{const n=a.transaction(d.VIDEO_CHUNKS,"readonly").objectStore(d.VIDEO_CHUNKS).openCursor(),i=[];n.onerror=()=>{t(n.error)},n.onsuccess=()=>{const c=n.result;c?(i.push(c==null?void 0:c.value.chunk),c==null||c.continue()):e(i)}})}const L=()=>{const e=indexedDB.deleteDatabase(m);e.onsuccess=()=>{console.log(`Database "${m}" deleted successfully.`)},e.onerror=t=>{console.error(`Error deleting database "${m}":`,t)},e.onblocked=()=>{location.reload()}},O=[{extension:".mp4",mime:'video/mp4; codecs="avc1.42E01E, mp4a.40.2"',codecs:"H.264 + AAC",note:"Best compatibility across all browsers"},{extension:".webm",mime:'video/webm; codecs="vp8, opus"',codecs:"VP8 + Opus",note:"Open format, supported in most modern browsers"},{extension:".webm",mime:'video/webm; codecs="vp9, opus"',codecs:"VP9 + Opus",note:"More efficient than VP8; supported in most modern browsers"},{extension:".ogv",mime:'video/ogg; codecs="theora, vorbis"',codecs:"Theora + Vorbis",note:"Open format, works in Firefox and Chrome"},{extension:".webm",mime:'video/webm; codecs="av1"',codecs:"AV1",note:"Next-gen codec, modern browsers only, limited hardware support"}];function g(e){const o=(e/1048576).toFixed(2)+"MB",r=(e/1024).toFixed(2)+"KB";return e>1048576?o:r}const s={mirrorBtn:document.getElementById("mirrorBtn"),playback:document.getElementById("playback"),preview:document.getElementById("preview"),startBtn:document.getElementById("startBtn"),stopBtn:document.getElementById("stopBtn"),videoChunks:document.getElementById("videoChunks"),videoSourceSelect:document.getElementById("videoSource"),recordingFormatSelect:document.getElementById("videoFormat"),chunkEverySelect:document.getElementById("chunkEvery"),resultLabel:document.getElementById("resultLabel"),clearDbBtn:document.getElementById("clearDbBtn")},k=/iPad|iPhone|iPod/.test(navigator.userAgent),E=localStorage.getItem("deviceId"),M=O;let l=null,u=null,f=!1;window.addEventListener("load",async()=>{k&&z(),A(),await w()&&(await x(),await R(),await _())});window.addEventListener("beforeunload",$);s.videoSourceSelect.addEventListener("change",N);s.mirrorBtn.addEventListener("click",F);s.startBtn.addEventListener("click",P);s.stopBtn.addEventListener("click",S);s.clearDbBtn.addEventListener("click",L);async function R(){try{const e=D(E),t=await navigator.mediaDevices.getUserMedia(e);y(t),V(await navigator.mediaDevices.enumerateDevices())}catch(e){console.error("Permission denied or error:",e)}}async function _(){const e=await v();e.length&&(b(e),B(e))}async function N(e){const t=e.target.value;localStorage.setItem("deviceId",t),await T(t)}async function T(e){try{U();const t=await navigator.mediaDevices.getUserMedia(D(e));y(t)}catch(t){console.error("Error switching camera:",t)}}function U(){u&&(u.getTracks().forEach(e=>e.stop()),u=null,S())}function y(e){u=e,s.preview.srcObject=e}function b(e){const t=new Blob(e,{type:s.recordingFormatSelect.value}),o=URL.createObjectURL(t);H(t),s.playback.src=o,s.playback.style.display="block"}function F(){const e=s.mirrorBtn.classList.toggle("mirrored");s.preview.style.transform=e?"scaleX(-1)":"scaleX(1)",s.mirrorBtn.innerHTML=e?"Unmirror":"Mirror",s.mirrorBtn.dataset.mirrored=String(e)}async function P(){if(!u)return;f=!0;const e=K();l=new MediaRecorder(u,{mimeType:e});const t=[];await I(),l.addEventListener("dataavailable",async o=>{o.data.size>0&&(t.push(o.data),await C(o.data))}),l.addEventListener("stop",async()=>{const o=await v(),r=o.length?o:t;b(r),B(r)}),l.start(Number(s.chunkEverySelect.value)),h(!0)}function S(){l&&l.state!=="inactive"&&l.stop(),h(!1),f=!1}function h(e){s.startBtn.disabled=e,s.stopBtn.disabled=!e}function V(e){const t=e.filter(o=>o.kind==="videoinput");s.videoSourceSelect.innerHTML="",t.forEach((o,r)=>{const n=document.createElement("option");n.value=o.deviceId,n.text=o.label||`Camera ${r+1}`,n.selected=E===o.deviceId||r===0,s.videoSourceSelect.appendChild(n)})}function x(){return new Promise(e=>{M.forEach((t,o)=>{const r=document.createElement("option");r.value=t.mime,r.text=`${t.extension}, ${t.codecs} (${t.note})`,r.selected=p.DEFAULT_RECORDING_FORMAT===t.mime||o===0,s.recordingFormatSelect.appendChild(r),e(s.recordingFormatSelect.value)})})}function B(e){s.videoChunks.innerHTML="",e.forEach((t,o)=>{const r=document.createElement("li");r.textContent=`Blob ${o+1}: { size: ${g(t.size)}, type: '${t.type}' }`,s.videoChunks.append(r)})}function A(){s.chunkEverySelect.value=String(p.DEFAULT_RECORD_TIME_SLICE)}function H(e){s.resultLabel.innerHTML=`Result (${g(e.size)}):`}function D(e){return{video:e?{deviceId:{exact:e}}:!0,audio:!0}}function K(){return MediaRecorder.isTypeSupported(s.recordingFormatSelect.value)?s.recordingFormatSelect.value:""}function $(e){f&&(e.preventDefault(),e.returnValue="")}function z(){alert("iOS detected. If you're experiencing issues, your browser may not fully support camera access (getUserMedia). Try using a different browser or device for the best experience.")}
