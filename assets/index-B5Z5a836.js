(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))n(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const d of i.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(t){if(t.ep)return;t.ep=!0;const i=r(t);fetch(t.href,i)}})();function y(e){console.log({B:`${e}B`,KB:`${(e/1024).toFixed(2)}KB`,MB:`${(e/(1024*1024)).toFixed(2)}MB`})}async function B(e){y(e.size)}const g=document.getElementById("preview"),l=document.getElementById("playback"),f=document.getElementById("startBtn"),p=document.getElementById("stopBtn"),a=document.getElementById("mirrorBtn"),u=document.getElementById("videoSource"),h=/iPad|iPhone|iPod/.test(navigator.userAgent),m=localStorage.getItem("deviceId");let c=null,s=null;window.onload=()=>{if(h){alert("iOS does not support getUserMedia. Please use a different device or browser.");return}w()};u.onchange=async e=>{const o=e.target.value;localStorage.setItem("deviceId",o),await I(o)};a.onclick=S;f.onclick=M;p.onclick=L;async function w(){try{const e={video:m?{deviceId:{exact:m}}:!0,audio:!0},o=await navigator.mediaDevices.getUserMedia(e);v(o),E(await navigator.mediaDevices.enumerateDevices())}catch(e){console.error("Permission denied or error:",e)}}async function I(e){try{const o={video:{deviceId:{exact:e}},audio:!0};b();const r=await navigator.mediaDevices.getUserMedia(o);v(r)}catch(o){console.error("Error switching camera:",o)}}function b(){s&&(s.getTracks().forEach(e=>e.stop()),s=null)}function v(e){s=e,g.srcObject=e}function S(){const e=a.classList.toggle("mirrored");g.style.transform=e?"scaleX(-1)":"scaleX(1)",a.innerHTML=e?"Unmirror":"Mirror",a.dataset.mirrored=String(e)}async function M(){if(!s)return;const e=MediaRecorder.isTypeSupported("video/webm")?"video/webm":"";c=new MediaRecorder(s,{mimeType:e});const o=[];c.ondataavailable=async r=>{r.data.size>0&&(o.push(r.data),await B(r.data))},c.onstop=()=>{const r=new Blob(o,{type:"video/webm"}),n=URL.createObjectURL(r);l.src=n,l.style.display="block",l.play()},c.start(2e3),f.disabled=!0,p.disabled=!1}function L(){c&&c.state!=="inactive"&&c.stop(),f.disabled=!1,p.disabled=!0}function E(e){const o=e.filter(r=>r.kind==="videoinput");u.innerHTML="",o.forEach((r,n)=>{const t=document.createElement("option");t.value=r.deviceId,t.text=r.label||`Camera ${n+1}`,t.selected=m===r.deviceId||n===0,u.appendChild(t)})}
